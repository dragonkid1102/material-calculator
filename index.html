<!DOCTYPE html>
<html lang="vi">
<head>
<meta name="app-version" content="1.0.6">
<!-- iOS PWA -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="WW Calculator">

<link rel="apple-touch-icon" href="icon-192.png">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#22e3ff">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>T√≠nh Nguy√™n Li·ªáu</title>

<style>
/* =========================================================
   ROOT VARIABLES
   ========================================================= */
:root {
  --bg-main:#050b18;
  --panel:#081428;
  --border:rgba(56,189,248,.2);
  --text:#e5f3ff;
  --sub:#9ccfff;
  --accent:#22e3ff;

  --gold:#ffd84d;
  --purple:#b56cff;
  --blue:#4aa3ff;
  --green:#2fdc7b;

  --ok:#2fdc7b;
  --fail:#ff4d4d;
  --extra:#ffd84d;
}

/* =========================================================
   BASE RESET
   ========================================================= */
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  padding: 10px;
  font-family: Inter, Segoe UI, system-ui, sans-serif;
  background: radial-gradient(circle at top,#0b1a33,#020617 60%);
  color: var(--text);
}

.container {
  width: 100%;
  max-width: 1100px;
  margin: auto;
}

/* =========================================================
   TYPOGRAPHY
   ========================================================= */
h2 {
  color: var(--accent);
  letter-spacing: 1px;
  margin: 20px 0 10px;
  font-size: 18px;
}

.sub-title {
  margin-bottom: 10px;
  color: var(--sub);
  font-weight: bold;
  letter-spacing: 0.5px;
  text-transform: uppercase;
  font-size: 13px;
  opacity: 0.85;
}

/* =========================================================
   SECTION / CARD
   ========================================================= */
.section {
  background: linear-gradient(
    180deg,
    rgba(20,35,70,0.92),
    rgba(5,10,25,0.92)
  );
  border: 1px solid var(--border);
  border-radius: 18px;
  padding: 14px;
  margin-bottom: 18px;
  box-shadow: 0 0 30px rgba(0,0,0,.6);
  backdrop-filter: blur(6px);
}

/* =========================================================
   GRID LAYOUT ‚Äî SINGLE SOURCE OF TRUTH
   ========================================================= */
.grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr); /* MOBILE */
  gap: 12px;
}

@media (min-width: 768px) {
  .grid {
    grid-template-columns: 1fr 1fr; /* TABLET */
    gap: 16px;
  }
}

@media (min-width: 1024px) {
  .grid {
    grid-template-columns: repeat(4, 1fr); /* DESKTOP */
    gap: 18px;
  }
}

/* =========================================================
   INPUT BOX
   ========================================================= */
.box {
  display: flex;
  flex-direction: column;
  gap: 3px;
  font-size: 13px;
  width: 100%;
}

input {
  width: 100%;
  height: 44px;
  padding: 12px 16px;
  border-radius: 999px;
  border: none;
  outline: none;
  text-align: center;
  font-size: 16px; /* iOS no zoom */
  font-weight: bold;
  color: #000;
  -webkit-appearance: none;
  appearance: none;
  transition: box-shadow 0.15s ease, transform 0.1s ease, filter 0.15s ease;
}

/* MATERIAL COLORS */
.gold   { background: linear-gradient(135deg,#ffe27a,var(--gold)); }
.purple { background: linear-gradient(135deg,#d0a3ff,var(--purple)); }
.blue   { background: linear-gradient(135deg,#8bc5ff,var(--blue)); }
.green  { background: linear-gradient(135deg,#7dffb7,var(--green)); }

/* =========================================================
   INPUT EFFECTS
   ========================================================= */
input:hover {
  filter: brightness(1.05);
}

input:focus {
  transform: scale(1.03);
  filter: brightness(1.1);
  box-shadow: 0 0 14px rgba(120,200,255,0.6);
}

input.gold:focus   { box-shadow: 0 0 14px rgba(255,215,0,0.6); }
input.purple:focus { box-shadow: 0 0 14px rgba(180,120,255,0.6); }
input.blue:focus   { box-shadow: 0 0 14px rgba(90,160,255,0.6); }
input.green:focus  { box-shadow: 0 0 14px rgba(80,220,150,0.6); }

/* =========================================================
   BUTTONS
   ========================================================= */
button {
  width: 100%;
  height: 56px;
  border: none;
  border-radius: 999px;
  font-size: 18px;
  font-weight: bold;
  cursor: pointer;
  background: linear-gradient(135deg,#3dffb2,#22c55e);
  box-shadow: 0 0 25px rgba(34,197,94,.7);
  text-shadow: 0 0 6px rgba(255,255,255,0.6);
  position: relative;
  overflow: hidden;
}

button:hover {
  filter: brightness(1.08);
}

/* SECONDARY BUTTONS */
.action-row {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin: 14px 0;
}

.btn-secondary {
  flex: 1;
  padding: 10px;
  border-radius: 12px;
  border: none;
  cursor: pointer;
  font-weight: 600;
  color: #dffaff;
  background: linear-gradient(180deg,#1b2b55,#0b1430);
  box-shadow: inset 0 0 0 1px rgba(120,180,255,0.25);
}

.btn-secondary:hover {
  filter: brightness(1.08);
}

.btn-secondary.danger {
  color: #ffdede;
  background: linear-gradient(180deg,#3a1a1a,#200909);
}

/* DESKTOP BUTTON LAYOUT */
@media (min-width: 768px) {
  .action-row {
    flex-direction: row;
  }
  .btn-secondary {
    width: auto;
  }
}

/* =========================================================
   RESULT TEXT
   ========================================================= */
#result {
  margin-top: 20px;
  line-height: 1.8;
}

.ok { color: var(--ok); font-weight: bold; }
.fail { color: var(--fail); font-weight: bold; }
.extra { color: var(--extra); font-weight: bold; }

.ok::before    { content:"‚úî "; text-shadow:0 0 10px var(--ok); }
.fail::before  { content:"‚úñ "; text-shadow:0 0 10px var(--fail); }
.extra::before { content:"‚ú¶ "; text-shadow:0 0 10px var(--extra); }

/* =========================================================
   ICON
   ========================================================= */
.icon {
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:18px;
  height:18px;
  border-radius:50%;
  margin-right:6px;
  font-size:12px;
  font-weight:bold;
  box-shadow:0 0 8px currentColor;
}

.icon.gold   { color:#ffd84d; }
.icon.purple { color:#b56cff; }
.icon.blue   { color:#4aa3ff; }
.icon.green  { color:#2fdc7b; }

/* =========================================================
   PROGRESS BAR
   ========================================================= */
#progress-wrap {
  margin-top: 20px;
}

#progress-text {
  margin-bottom: 6px;
  color: var(--sub);
  font-weight: bold;
}

.progress-bar-bg {
  width: 100%;
  height: 14px;
  border-radius: 999px;
  background: rgba(255,255,255,0.1);
  overflow: hidden;
}

#progress-bar {
  height: 100%;
  width: 0%;
  border-radius: 999px;
  background: linear-gradient(90deg,#22e3ff,#2fdc7b);
  box-shadow: 0 0 15px rgba(34,227,255,0.8);
  transition: width 0.4s ease;
}

.progress-fail {
  background: linear-gradient(90deg,#ff4d4d,#ffae42) !important;
  box-shadow: 0 0 15px rgba(255,77,77,0.8) !important;
}

/* =========================================================
   ANIMATION
   ========================================================= */
@keyframes pulse {
  0% { box-shadow:0 0 0 rgba(34,227,255,0); }
  50% { box-shadow:0 0 25px rgba(34,227,255,.8); }
  100% { box-shadow:0 0 0 rgba(34,227,255,0); }
}

.animate {
  animation: pulse .6s ease;
}

/* =========================================================
   UTILITY
   ========================================================= */
.hidden {
  display: none;
}

/* =========================================================
   DESKTOP INPUT NARROW (KEEP HEIGHT, BETTER BALANCE)
   ========================================================= */
@media (min-width: 1024px) {
  input {
    max-width: 200px;
    margin: 0;
  }

  .box {
    align-items: flex-start;
    gap: 3px;
  }

  .grid {
    gap: 10px;
  }
}
/* =========================================================
   SECTION TOGGLE
   ========================================================= */
.section-disabled {
  display: none;
}

h2 label {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  user-select: none;
}

h2 input[type="checkbox"] {
  transform: scale(1.2);
}
/* =========================================================
   SECTION TOGGLE ‚Äì GAME STYLE
   ========================================================= */
.section-toggle {
  display: inline-flex;
  align-items: center;
  gap: 12px;
  cursor: pointer;
  user-select: none;
  font-weight: 700;
  letter-spacing: .5px;
}

/* ·∫®n checkbox g·ªëc */
.section-toggle input {
  display: none;
}

/* Thanh toggle */
.toggle-ui {
  width: 46px;
  height: 24px;
  background: rgba(255,255,255,.15);
  border-radius: 999px;
  position: relative;
  transition: background .25s ease, box-shadow .25s ease;
  box-shadow: inset 0 0 0 1px rgba(120,180,255,.25);
}

/* N√∫t tr√≤n */
.toggle-ui::after {
  content: "";
  position: absolute;
  top: 3px;
  left: 3px;
  width: 18px;
  height: 18px;
  background: linear-gradient(135deg,#e0f6ff,#8ad8ff);
  border-radius: 50%;
  transition: transform .25s ease;
  box-shadow: 0 0 6px rgba(100,200,255,.6);
}

/* B·∫¨T */
.section-toggle input:checked + .toggle-ui {
  background: linear-gradient(135deg,#22e3ff,#2fdc7b);
  box-shadow: 0 0 12px rgba(34,227,255,.8);
}

.section-toggle input:checked + .toggle-ui::after {
  transform: translateX(22px);
}

/* Text */
.toggle-text {
  color: var(--sub);
  text-transform: uppercase;
  font-size: 13px;
}

.section-toggle:hover .toggle-ui {
  filter: brightness(1.1);
}

</style>

</head>

<body>
<div class="container">

<h2>‚ñ≤ NGUY√äN LI·ªÜU C·∫¶N</h2>
<!-- K·ª∏ NƒÇNG -->
<div class="section">
	<div class="sub-title">
		<label class="section-toggle">
			<input type="checkbox" id="toggle-skill" checked>
			<span class="toggle-ui"></span>
			<span class="toggle-text">K·ªπ NƒÉng</span>
		</label>
	</div>
	
	<div class="grid" id="skill-section">
		<div class="box">üü° V√†ng<input id="s_gold" class="gold" value="67"></div>
		<div class="box">üü£ T√≠m<input id="s_purple" class="purple" value="55"></div>
		<div class="box">üîµ Xanh D∆∞∆°ng<input id="s_blue" class="blue" value="28"></div>
		<div class="box">üü¢ Xanh L√°<input id="s_green" class="green" value="25"></div>
	</div>
</div>

<!-- V≈® KH√ç -->
<div class="section">
	<div class="sub-title">
		<label class="section-toggle">
			<input type="checkbox" id="toggle-weapon" checked>
			<span class="toggle-ui"></span>
			<span class="toggle-text">V≈® KH√ç</span>
		</label>
	</div>
	
	<div class="grid" id="weapon-section">
		<div class="box">üü° V√†ng<input id="w_gold" class="gold" value="20"></div>
		<div class="box">üü£ T√≠m<input id="w_purple" class="purple" value="6"></div>
		<div class="box">üîµ Xanh D∆∞∆°ng<input id="w_blue" class="blue" value="8"></div>
		<div class="box">üü¢ Xanh L√°<input id="w_green" class="green" value="6"></div>
	</div>
</div>

<h2>‚ñº HI·ªÜN C√ì</h2>

<div class="section">
<div class="grid">
<div class="box">üü° V√†ng<input id="h_gold" class="gold" value=""></div>
<div class="box">üü£ T√≠m<input id="h_purple" class="purple" value=""></div>
<div class="box">üîµ Xanh D∆∞∆°ng<input id="h_blue" class="blue" value=""></div>
<div class="box">üü¢ Xanh L√°<input id="h_green" class="green" value=""></div>
</div>
</div>

<div class="action-row">
    <button class="btn-secondary" onclick="resetDefault()">üîÅ M·∫∑c ƒê·ªãnh</button>
    <button class="btn-secondary danger" onclick="clearAllInputs()">üóë X√≥a H·∫øt</button>
</div>

<button onclick="calculate()">T√çNH TO√ÅN</button>
<!-- PROGRESS BAR -->
<div id="progress-wrap">
    <div id="progress-text">Ho√†n th√†nh: 0%</div>
    <div class="progress-bar-bg">
        <div id="progress-bar"></div>
    </div>
</div>

<div id="result"></div>
<!-- BUTTON TOGGLE TEST -->
<button onclick="toggleTestPanel()" style="margin-bottom:10px">
    Debug
</button>

<div id="test-panel" class="hidden">
    <!-- ===== TEST PANEL (GI·ªÆ NGUY√äN N·ªòI DUNG B√äN TRONG) ===== -->
    <div class="section">
        <div class="sub-title">üß™ Test t·ª± ƒë·ªông</div>

        <button onclick="runUITests()">Ch·∫°y Test C·ªë ƒê·ªãnh</button>
        <button onclick="runFuzzTest()">Ch·∫°y Fuzz Test (Random)</button>

        <div id="test-summary" style="margin-top:10px;font-weight:bold"></div>
        <div id="test-results" style="margin-top:10px;line-height:1.6"></div>
    </div>
</div>
<div id="app-version" class="version"></div>
</div>

<script>
const MATERIAL_LABEL = {
  gold: "V√†ng",
  purple: "T√≠m",
  blue: "Xanh D∆∞∆°ng",
  green: "Xanh L√°"
};
const MATERIAL_ICON = {
  gold: "üü°",
  purple: "üü£",
  blue: "üîµ",
  green: "üü¢"
};
/* =========================================================
   CORE LOGIC ‚Äì SINGLE SOURCE OF TRUTH
   ========================================================= */
function solveMaterial(need, have) {
    let done = { gold:0, purple:0, blue:0, green:0 };
    let remain = { ...have };

    function consume(mat) {
        if (mat === "gold") {
            if (remain.gold > 0) { remain.gold--; return true; }
            if (remain.purple >= 3) { remain.purple -= 3; return true; }
            if (remain.blue >= 9) { remain.blue -= 9; return true; }
            if (remain.green >= 27) { remain.green -= 27; return true; }
            return false;
        }
        if (mat === "purple") {
            if (remain.purple > 0) { remain.purple--; return true; }
            if (remain.blue >= 3) { remain.blue -= 3; return true; }
            if (remain.green >= 9) { remain.green -= 9; return true; }
            return false;
        }
        if (mat === "blue") {
            if (remain.blue > 0) { remain.blue--; return true; }
            if (remain.green >= 3) { remain.green -= 3; return true; }
            return false;
        }
        if (mat === "green") {
            if (remain.green > 0) { remain.green--; return true; }
            return false;
        }
    }

    ["gold","purple","blue","green"].forEach(mat => {
        for (let i = 0; i < need[mat]; i++) {
            if (consume(mat)) done[mat]++;
            else break;
        }
    });

    let thi·∫øu = {};
    for (let k in need) {
        if (done[k] < need[k]) thi·∫øu[k] = need[k] - done[k];
    }

    return { done, remain, thi·∫øu };
}

/* =========================================================
   MAIN CALCULATE ‚Äì UI ONLY
   ========================================================= */
function calculate() {
    const need = {
        gold:(+s_gold.value||0)+(+w_gold.value||0),
        purple:(+s_purple.value||0)+(+w_purple.value||0),
        blue:(+s_blue.value||0)+(+w_blue.value||0),
        green:(+s_green.value||0)+(+w_green.value||0),
    };

    const have = {
        gold:+h_gold.value||0,
        purple:+h_purple.value||0,
        blue:+h_blue.value||0,
        green:+h_green.value||0,
    };

    const { done, remain, thi·∫øu } = solveMaterial(need, have);

    /* ===== PROGRESS ===== */
    const totalNeed = need.gold + need.purple + need.blue + need.green;
    const totalDone = done.gold + done.purple + done.blue + done.green;
    const percent = totalNeed === 0 ? 100 : Math.min(100, Math.floor(totalDone / totalNeed * 100));

    const bar = document.getElementById("progress-bar");
    const text = document.getElementById("progress-text");
    bar.style.width = percent + "%";
    text.innerText = `Ho√†n th√†nh: ${percent}%`;
    bar.classList.toggle("progress-fail", percent < 100);

    /* ===== RESULT ===== */
    let html = `
    <b>Hi·ªán ƒëang c√≥:</b><br>
    <span class="icon gold">‚óè</span>V√†ng: <span data-count="${done.gold}">0</span> / ${need.gold}<br>
    <span class="icon purple">‚óè</span>T√≠m: <span data-count="${done.purple}">0</span> / ${need.purple}<br>
    <span class="icon blue">‚óè</span>Xanh D∆∞∆°ng: <span data-count="${done.blue}">0</span> / ${need.blue}<br>
    <span class="icon green">‚óè</span>Xanh L√°: <span data-count="${done.green}">0</span> / ${need.green}<br><br>
    `;

    if (Object.keys(thi·∫øu).length === 0) {
        html += `<div class="ok">ƒê√É ƒê·ª¶ NGUY√äN LI·ªÜU</div>`;
    } else {
        html += `<div class="fail">THI·∫æU NGUY√äN LI·ªÜU</div>`;
        for (let k in thi·∫øu) {
			html += `${MATERIAL_ICON[k]} Thi·∫øu ${thi·∫øu[k]} ${MATERIAL_LABEL[k]}<br>`;
		}
		
    }

    const d∆∞ = [];
    if (remain.gold > 0) d∆∞.push(`D∆∞ ${remain.gold} V√†ng`);
    if (remain.purple > 0) d∆∞.push(`D∆∞ ${remain.purple} T√≠m`);
    if (remain.blue > 0) d∆∞.push(`D∆∞ ${remain.blue} Xanh D∆∞∆°ng`);
    if (remain.green > 0) d∆∞.push(`D∆∞ ${remain.green} Xanh L√°`);

    if (d∆∞.length) html += `<br><div class="extra">D∆Ø TH·ª™A</div>` + d∆∞.join("<br>");

    const result = document.getElementById("result");
    result.innerHTML = html;

    /* ===== COUNT UP ===== */
    result.querySelectorAll("[data-count]").forEach(el => {
        const target = +el.dataset.count;
        let cur = 0;
        const step = Math.max(1, Math.ceil(target / 20));
        const timer = setInterval(() => {
            cur += step;
            if (cur >= target) {
                el.textContent = target;
                clearInterval(timer);
            } else el.textContent = cur;
        }, 20);
    });

    /* ===== PULSE ===== */
    result.classList.remove("animate");
    void result.offsetWidth;
    result.classList.add("animate");
}

/* =========================================================
   RIPPLE EFFECT
   ========================================================= */
document.querySelectorAll("button").forEach(btn => {
    btn.addEventListener("click", e => {
        const rect = btn.getBoundingClientRect();
        const circle = document.createElement("span");
        const d = Math.max(btn.clientWidth, btn.clientHeight);
        const r = d / 2;
        circle.style.width = circle.style.height = d + "px";
        circle.style.left = e.clientX - rect.left - r + "px";
        circle.style.top = e.clientY - rect.top - r + "px";
        circle.className = "ripple";
        btn.querySelector(".ripple")?.remove();
        btn.appendChild(circle);
    });
});

/* =========================================================
   TEST UI + FUZZ
   ========================================================= */
function runUITests() {
    const cases = [
        { name:"27 green ‚Üí 1 gold", need:{gold:1,purple:0,blue:0,green:0}, have:{gold:0,purple:0,blue:0,green:27}, exp:{gold:1,purple:0,blue:0,green:0} },
        { name:"No reverse", need:{gold:0,purple:0,blue:0,green:1}, have:{gold:0,purple:0,blue:9999,green:0}, exp:{gold:0,purple:0,blue:0,green:0} },
        { name:"Hard case", need:{gold:1,purple:1,blue:1,green:1}, have:{gold:0,purple:0,blue:9999,green:0}, exp:{gold:1,purple:1,blue:1,green:0} },
    ];

    let pass = 0;
    let html = "";

    cases.forEach(tc => {
        const r = solveMaterial(tc.need, tc.have);
        const ok = JSON.stringify(r.done) === JSON.stringify(tc.exp);
        if (ok) pass++;
        html += `<div class="test-case ${ok?"test-pass":"test-fail"}">
            ${ok?"‚úÖ PASS":"‚ùå FAIL"} ‚Äì ${tc.name}
        </div>`;
    });

    document.getElementById("test-summary").innerText =
        `K·∫øt qu·∫£: ${pass}/${cases.length} PASS`;
    document.getElementById("test-results").innerHTML = html;
}

function runFuzzTest() {
    let total = 300, pass = 0;

    for (let i = 0; i < total; i++) {
        const need = {
            gold:Math.random()*3|0,
            purple:Math.random()*3|0,
            blue:Math.random()*3|0,
            green:Math.random()*3|0
        };

        const have = {
            gold:Math.random()*5|0,
            purple:Math.random()*10|0,
            blue:Math.random()*50|0,
            green:Math.random()*100|0
        };

        const r = solveMaterial(need, have);

        // Lu·∫≠t c·∫•m gh√©p ng∆∞·ª£c
        if (need.green > 0 && have.green === 0 && r.done.green > 0) continue;

        pass++;
    }

    document.getElementById("test-summary").innerText =
        `Fuzz Test: ${pass}/${total} PASS`;
    document.getElementById("test-results").innerHTML =
        pass === total
        ? `<div class="test-pass">‚úÖ Kh√¥ng ph√°t hi·ªán gh√©p ng∆∞·ª£c</div>`
        : `<div class="test-fail">‚ùå C√≥ l·ªói</div>`;
}

function toggleTestPanel() {
    document.getElementById("test-panel").classList.toggle("hidden");
}

const DEFAULT_VALUES = {
    s_gold: 67,
    s_purple: 55,
    s_blue: 28,
    s_green: 25,

    w_gold: 20,
    w_purple: 6,
    w_blue: 8,
    w_green: 6,

    h_gold: "",
    h_purple: "",
    h_blue: "",
    h_green: ""
};
function resetDefault() {
    for (const id in DEFAULT_VALUES) {
        const el = document.getElementById(id);
        if (el) el.value = DEFAULT_VALUES[id];
    }
}
function clearAllInputs() {
    document.querySelectorAll("input").forEach(input => {
        input.value = "";
    });
}
const version = document
  .querySelector('meta[name="app-version"]')
  .getAttribute("content");

document.getElementById("app-version").innerText =
  `Phi√™n b·∫£n: v${version}`;

/* =========================================================
   KEYBOARD NAVIGATION (EXCEL-LIKE)
   ========================================================= */
(function enableKeyboardNavigation() {
  const inputs = Array.from(document.querySelectorAll("input"));

  inputs.forEach((input, index) => {
    input.addEventListener("keydown", e => {

      // ENTER ‚Üí next input
      if (e.key === "Enter") {
        e.preventDefault();
        inputs[index + 1]?.focus();
      }
    });
  });
})();

</script>

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js").then(reg => {

    if (reg.waiting) showUpdateBanner(reg);

    reg.addEventListener("updatefound", () => {
      const newWorker = reg.installing;
      newWorker.addEventListener("statechange", () => {
        if (
          newWorker.state === "installed" &&
          navigator.serviceWorker.controller
        ) {
          showUpdateBanner(reg);
        }
      });
    });
  });

  function showUpdateBanner(reg) {
    if (document.getElementById("update-banner")) return;

    const banner = document.createElement("div");
    banner.id = "update-banner";
    banner.innerHTML = `
      <div style="
        position:fixed;
        bottom:16px;
        left:50%;
        transform:translateX(-50%);
        background:#22e3ff;
        color:#000;
        padding:12px 16px;
        border-radius:14px;
        font-weight:bold;
        z-index:9999;
        box-shadow:0 6px 20px rgba(0,0,0,.4);
      ">
        üöÄ C√≥ b·∫£n c·∫≠p nh·∫≠t m·ªõi
        <button id="update-btn"
          style="
            margin-left:10px;
            padding:6px 12px;
            border:none;
            border-radius:8px;
            cursor:pointer;
            font-weight:bold;
          ">
          C·∫≠p nh·∫≠t
        </button>
      </div>
    `;
    document.body.appendChild(banner);

    document.getElementById("update-btn").onclick = () => {
      (reg.waiting || reg.installing)?.postMessage({ type: "SKIP_WAITING" });
    };
  }

  navigator.serviceWorker.addEventListener("controllerchange", () => {
    window.location.reload();
  });
}
</script>
<script>
/* =========================================================
   üî• SAFE SERVICE WORKER RESET (ONLY WITH ?reset)
   ========================================================= */
(async function resetPWAIfRequested() {
  const params = new URLSearchParams(location.search);
  if (!params.has("reset")) return;

  if (!("serviceWorker" in navigator)) return;

  console.warn("üßπ PWA RESET MODE ENABLED");

  // 1Ô∏è‚É£ Unregister all Service Workers
  const regs = await navigator.serviceWorker.getRegistrations();
  for (const reg of regs) {
    console.warn("‚ùå Unregister SW:", reg.scope);
    await reg.unregister();
  }

  // 2Ô∏è‚É£ Clear all caches
  if ("caches" in window) {
    const keys = await caches.keys();
    for (const key of keys) {
      console.warn("üóë Delete cache:", key);
      await caches.delete(key);
    }
  }

  console.warn("‚úÖ PWA RESET DONE");

  // 3Ô∏è‚É£ Reload WITHOUT ?reset
  params.delete("reset");
  const cleanUrl =
    location.pathname +
    (params.toString() ? "?" + params.toString() : "");

  setTimeout(() => {
    location.replace(cleanUrl);
  }, 300);
})();

/* =========================================================
   TOGGLE SKILL / WEAPON SECTION
   ========================================================= */
function toggleSection(toggleId, sectionId, inputPrefix) {
  const toggle = document.getElementById(toggleId);
  const section = document.getElementById(sectionId);
  const inputs = section.querySelectorAll("input");

  // L∆∞u gi√° tr·ªã g·ªëc
  inputs.forEach(i => {
    if (!i.dataset.lastValue) {
      i.dataset.lastValue = i.value;
    }
  });

  toggle.addEventListener("change", () => {
    if (!toggle.checked) {
      // T·∫Øt section
      section.classList.add("section-disabled");
      inputs.forEach(i => {
        i.dataset.lastValue = i.value;
        i.value = 0;
      });
    } else {
      // B·∫≠t l·∫°i section
      section.classList.remove("section-disabled");
      inputs.forEach(i => {
        i.value = i.dataset.lastValue || 0;
      });
    }
  });
}

// √Åp d·ª•ng
toggleSection("toggle-skill", "skill-section");
toggleSection("toggle-weapon", "weapon-section");

</script>

</body>
</html>
